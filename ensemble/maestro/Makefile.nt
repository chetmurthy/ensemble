#*************************************************************#
#
#   Ensemble, 1_42
#   Copyright 2003 Cornell University, Hebrew University
#           IBM Israel Science and Technology
#   All rights reserved.
#
#   See ensemble/doc/license.txt for further information.
#
#*************************************************************#
# -*- Mode: makefile -*- 
#*************************************************************#
#
# Main Maestro Makefile
#
# Author: Ohad Rodeh 4\2003
# Based on code by Alexey Vaysburd
#
#*************************************************************#
ENSROOT = ..
!include $(ENSROOT)\mk\preamble.nmk
!include $(ENSROOT)\mk\config.nmk
!include $(ENSROOT)\maestro\ma_config.nmk
#*************************************************************#

INCLUDE_PATH	=\
		-I $(ENSLIB)\
		-I $(ENSROOT)\hot\include

.SUFFIXES: .C .o .obj
.C.o : 
	$(CCC) $(CFLAGS) $(INCLUDE_PATH) -c  $< -o $@
.C.obj : 
	$(CCC) $(CFLAGS) $(INCLUDE_PATH) -c  $< $(OBJRULE)$@

#**********************************************************

HOTLIB		= $(ENSROOT)\lib\$(PLATFORM)\libhot$(ARC)

CRYPTOLIB	=
#CRYPTOLIB	= $(ENS)\lib\$(PLATFORM)\libcryptoc.a


MAE_OBJ = 	Maestro_Types$(OBJ)\
		Maestro_GroupMember$(OBJ)\
		Maestro_ClSv$(OBJ)\
		Maestro_CSX$(OBJ)\
		Maestro_Prim$(OBJ)\
		Maestro_Group$(OBJ)

MAELIB		= $(ENSLIB)\libmae$(ARC)
LIBS		= $(MAELIB) $(HOTLIB) $(CRYPTOLIB) 


all:\
	$(ENSLIB)\libmae$(ARC)\
	$(ENSBIN)\maestro-test$(EXE)

############################################################################

$(ENSLIB)\libmae$(ARC): $(MAE_OBJ)
	$(MKLIB) $(MKLIBO)$(ENSLIB)\libmae$(ARC) $(MAE_OBJ)
	$(RANLIB) $(ENSLIB)\libmae$(ARC)

$(ENSBIN)\maestro-group-test$(EXE): maestro-group-test$(OBJ) $(LIBS)
	$(CCC) -o $(ENSBIN)\maestro-group-test$(EXE) maestro-group-test$(OBJ) $(LIBS) $(MA_LINK_FLAGS)

$(ENSBIN)\maestro-test$(EXE): maestro-test$(OBJ) $(LIBS) 
	$(CCC) -o $(ENSBIN)\maestro-test$(EXE) maestro-test$(OBJ) $(LIBS) $(MA_LINK_FLAGS)

$(ENSBIN)\maestro-test2$(EXE): maestro-test2$(OBJ) $(LIBS) 
	$(CCC) -o $(ENSBIN)\maestro-test2$(EXE) maestro-test2$(OBJ) $(LIBS) $(MA_LINK_FLAGS)

$(ENSBIN)\maestro-perf$(EXE): maestro-perf$(OBJ) $(LIBS)
	$(CCC) -o $(ENSBIN)\maestro-perf$(EXE) maestro-perf$(OBJ) $(LIBS) $(MA_LINK_FLAGS)

clean : 
	$(CLEANDIR)

realclean : 
	$(CLEANDIR)

#
# Currently, maestro does not support 'nmake -f Makefile.nt depend'
depend : 
	echo "currently depend generation not supported"